---
import { SITE_INFO } from "../consts";

// 获取 about.md（如果存在的话，作为特殊置顶）
const aboutArticles = await Astro.glob("../pages/about.md");

// 获取所有 docs 文件夹下的文章
const docsArticles = await Astro.glob("../pages/docs/*.md");

// 按文件名排序（反转以获得最新的在前）
const sortedDocsArticles = docsArticles.reverse();

// 从 docs 中分离置顶文章和普通文章
const pinnedDocsArticles = sortedDocsArticles.filter(post => post.frontmatter.pinned === true);
const normalArticles = sortedDocsArticles.filter(post => post.frontmatter.pinned !== true);

// 合并所有文章：about.md + docs中的置顶 + docs中的普通文章
const displayArticles = [...aboutArticles, ...pinnedDocsArticles, ...normalArticles];
---

<article class="article-container docs">
    {
        displayArticles.map((post, index) => {
            const isLast = index === displayArticles.length - 1;
            const isPinned = post.frontmatter.pinned === true;
            
            return (
                <div class={`docs-body ${isPinned ? 'docs-fixed' : ''} ${isLast ? 'docs-last' : ''}`}>
                    <a href={post.url} class="docs-a">
                        <h2 class="docs-h">{post.frontmatter.title}</h2>
                    </a>
                    <p class="docs-p">{post.frontmatter.desc}</p>
                    <time class="docs-t">{post.frontmatter.pubDate.substr(0, 10)}</time>
                </div>
            );
        })
    }
    
    {/* 底部结束提示 */}
    <footer class="docs-footer">
        <p class="end-tip">{SITE_INFO.endTip}</p>
    </footer>
</article>
