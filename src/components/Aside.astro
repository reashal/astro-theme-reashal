---
import "../styles/aside.css";
import { AUTHOR_INFO, NAV_LINKS, SITE_INFO } from "../consts";
---

<aside>
    <section class="aside-body">
        <section class="aside-author">
            <img
                class="aside-avatar"
                src={AUTHOR_INFO.avatar}
                alt={AUTHOR_INFO.name}
                title={AUTHOR_INFO.name}
                loading="lazy"
                decoding="async"
            />
            <div class="aside-author-info">
                <h3 class="aside-name">{AUTHOR_INFO.name}</h3>
                <p class="aside-desc">{AUTHOR_INFO.description}</p>
                <p class="aside-detail">{AUTHOR_INFO.detailDescription || AUTHOR_INFO.description}</p>
            </div>
        </section>
        <section class="aside-links">
            {
                NAV_LINKS.map((link) => (
                    <a
                        href={link.href}
                        target={link.external ? "_blank" : "_self"}
                        class={link.icon}
                    >
                        {link.label}
                    </a>
                ))
            }
        </section>
        <section class="aside-share">
            <a class="aside-share-link" id="aside-share-btn" aria-label="分享当前页面">
                <i class="iconfont icon-share"></i>
                分享当前页面
            </a>
        </section>
        <section class="aside-copyright">
            <div>
                Powered By <a href="//astro.build" class="copy-a" target="_blank"
                    >Astro</a
                >
            </div>
            <div>
                Themed By <a href="//www.reashal.com" class="copy-a" target="_blank"
                    >reashal</a
                >
            </div>
        </section>
    </section>
    <div class="aside-btn" onclick="clickAsideBtn()"></div>
</aside>

<script define:vars={{ SITE_INFO }}>
    const asideShareBtn = document.getElementById('aside-share-btn');
    
    if (asideShareBtn) {
        asideShareBtn.addEventListener('click', () => {
            // 折叠侧边栏
            if (typeof clickAsideBtn === 'function') {
                clickAsideBtn();
            }
            
            // 延迟弹出分享卡片，等待侧边栏折叠
            setTimeout(() => {
                // 动态获取当前页面信息
                const url = window.location.href;
                const title = document.title.split('｜')[0].trim();
                const description = document.querySelector('meta[name="description"]')?.getAttribute('content') || '';
                
                // 触发分享卡片
                const shareBtn = document.getElementById('share-btn');
                if (shareBtn) {
                    shareBtn.click();
                }
            }, 300);
        });
    }
</script>
